# MQTT SparkplugB

The MQTT SparkplugB driver in VC Hub is designed and developed based on the MQTT protocol and supports the transmission of message information that satisfies the SparkplugB protocol. At the same time, the system comes with an MQTT Broker, which allows the user to connect with the account and password provided by the system and communicate with the data via the MQTT SparkplugB driver.
### **Driver Connection to MQTT Broker**

1. On the "**Devices**" -> "**MQTT SparkplugB** page, click the "**Add Group**" button.

Groups: Groups are a way to organize devices into groups for easier management and operation.

2. Enter a **group name** in the Add page. 

<img width="1895" height="266" alt="image" src="https://github.com/user-attachments/assets/0eecc107-d22a-4c85-8425-67cef6dc1c35" />



3. Click the **"OK"** button. The data will be displayed in the device list page of MQTT SparkplugB. 

<img width="1896" height="265" alt="image" src="https://github.com/user-attachments/assets/cd9aaffe-f442-4ac5-a6f0-7792419e08e0" />



4. Click "Add Node" in the Operation column, enter the node name and add a new node for the current group.

Node: Node represents the entity of a specific device, and has a unique identifier, which is used to distinguish each device. 

<img width="1905" height="300" alt="image" src="https://github.com/user-attachments/assets/9d6496eb-b987-4938-87ef-ffb61965f60e" />


5. Click the **"OK"** button. The data will be displayed in the node list page of the current group. Please note that the status column only indicates the start/stop status of the current node, not the connection status. 

<img width="1905" height="333" alt="image" src="https://github.com/user-attachments/assets/066e3514-0a61-4d1d-a583-fcf2df3c40e3" />



6. Click the Enable button in the Enable Status column to enable the node.

<img width="1894" height="320" alt="image" src="https://github.com/user-attachments/assets/0ea67ee1-0f72-4248-9c1e-01a6fd0d7517" />


**Configuration Fields**

| **Name**   | **Description**                                                                                                                   |
|------------|-----------------------------------------------------------------------------------------------------------------------------------|
| Group Name | The group name of the driver, unique in the driver list.                                                                          |
| Node Name  | Name of a node of the group, unique in the group.                                                                                 |
| Username   | The account number used to connect to a particular edge node (EoN), automatically generated by the system and cannot be modified. |
| Password   | Password used to connect with a certain edge node (EoN), automatically generated by the system, supports reset.                   |

**Note:**

1. In the node list, The **Enabled Status** indicates whether the device has been enabled or not, unenabled devices will not connect and enabled devices will try to connect; the **Connection Status** indicates whether the device has successfully established a communication connection with the system.
2. **Enable All** and **Disable All **are to enable or disable all data in the list.
3. Please keep the user name and password information in a safe place to avoid leakage to unauthorized personnel, and if leakage occurs, please reset the password in time.

Data types currently supported by the system:

| **Type** | **Description**                         |
|----------|-----------------------------------------|
| Int8     | 8-bit signed integer                    |
| Int16    | 16-bit signed integer                   |
| Int32    | 32-bit signed integer                   |
| Int64    | 64-bit signed integer                   |
| UInt8    | 8-bit unsigned integer                  |
| UInt16   | 16-bit unsigned integers                |
| UInt32   | 32-bit unsigned integers                |
| UInt64   | 32-bit unsigned integers                |
| Float    | Single precision floating point         |
| Double   | Double precision floating point numbers |
| Boolean  | Boolean                                 |
| String   | String                                  |
| Text     | Text; same as string                    |
| DateTime | Date                                    |

## **Connecting to the System MQTT Broker**

Before you can use the MQTT SparkplugB driver, you need to connect to the system's Sparkplug Application, follow the steps below to do so:

1. Get account and password: Click the "View" button on the node to see the username and password provided by the system.
2. Configure Client: In your application or device, configure the edge node (SparkplugB Node) to connect to the system's Sparkplug Application:

   - Broker Address: Fill in the address of the system MQTT Broker.
   - Broker Port: Fill in the port number of the system MQTT Broker. The default is 1884.
   - Client ID: Fill in a unique client identifier that identifies your connection on the system MQTT Broker.
   - Username and Password: Use the account and password you obtained in the system.
   - ScadaHostIdentifier: WagoScada
   - GroupName: corresponds to the group name in the driver list
   - NodeName: corresponds to the node name in the driver list group
3. Connecting to the MQTT Broker: Using an MQTT client that supports the SparkplugB protocol, connect to the system's MQTT Broker in your application or device, and after confirming that the connection is successful, you can start using the client to transfer device data with the MQTT SparkplugB driver.
4. The messaging follows the SparkplugB protocol, for more information please refer to the official documentation at [ https://www.eclipse.org/tahu/spec/sparkplug_spec.pdf]( https://www.eclipse.org/tahu/spec/sparkplug_spec.pdf) .

## **Binding to tags**

Bind a tag to a client measurement point.

1. Create an I/O tag

<img width="380" height="412" alt="image" src="https://github.com/user-attachments/assets/5421c3ec-0f33-4ada-9108-e56371e08a2b" />

2. On the edit screen of the tag, click the binding button of the data source.

<img width="837" height="619" alt="image" src="https://github.com/user-attachments/assets/abfc88dc-3b7d-4460-83e9-c2f2b71eb92f" />


3. Select the groups, nodes, devices, and directories to be bound, and check the measurement points with matching data types.

<img width="1291" height="753" alt="image" src="https://github.com/user-attachments/assets/cdc1aca2-bbac-4f3c-817d-5dd9e41ad808" />


4. Click the "**OK**" button to complete the configuration.

